# 커피 주문 앱

## 1. 프로젝트 개요

### 1.1 프로젝트명
커피 주문 앱

### 1.2 프로젝트 목적
사용자가 커피 메뉴를 주문하고, 관리자가 주문을 관리할 수 있는 간단한 풀스택 웹 앱

### 1.3 개발 범위
- 주문하기 화면(메뉴 선택 및 장바구니 기능)
- 관리자 화면(재고 관리 및 주문 상태 관리)
- 데이터를 생성/조회/수정/삭제할 수 있는 기능

## 2. 기술 스택
- 프런트엔드: HTML, CSS, 리액트, 자바스크립트
- 백엔드: Node.js, Express
- 데이터베이스: PostgreSQL

## 3. 기본 사항
- 프런트엔드와 백엔드를 따로 개발
- 기본적인 웹 기술만 사용
- 학습 목적이므로 사용자 인증이나 결제 기능은 제외
- 메뉴는 커피 메뉴만 있음

## 4. 주문하기 화면 UI/UX 요구사항

### 4.1 화면 구성
주문하기 화면은 헤더, 메뉴 아이템 영역, 장바구니 영역으로 구성된다.

### 4.2 헤더 영역
- **위치**: 화면 최상단
- **구성 요소**:
  - 좌측: "COZY" 로고 박스
    - 배경색: 다크 그린
    - 텍스트 색상: 흰색
    - 형태: 직사각형 박스
  - 우측: 네비게이션 버튼
    - "주문하기" 버튼
    - "관리자" 버튼

### 4.3 메뉴 아이템 영역
- **위치**: 헤더 하단
- **레이아웃**: 메뉴 아이템 카드들이 가로로 배치 (그리드 레이아웃)
- **메뉴 아이템 카드 구성**:
  - **이미지 영역**
    - 상단에 메뉴 이미지 표시 영역
    - 이미지가 없을 경우 플레이스홀더 표시 (대각선이 그어진 흰색 박스)
  - **메뉴 정보**
    - 메뉴명 (예: "아메리카노(ICE)", "아메리카노(HOT)", "카페라떼")
    - 가격 (예: "4,000원", "5,000원")
    - 설명 (예: "간단한 설명...")
  - **옵션 선택**
    - 체크박스 형태의 옵션 선택 UI
    - 각 옵션은 옵션명과 추가 가격을 표시
      - 예: "샷 추가 (+500원)"
      - 예: "시럽 추가 (+0원)"
    - 여러 옵션을 동시에 선택 가능
  - **담기 버튼**
    - 카드 하단에 "담기" 버튼 배치
    - 배경색: 회색
    - 클릭 시 선택한 옵션과 함께 장바구니에 추가

### 4.4 장바구니 영역
- **위치**: 화면 하단
- **제목**: "장바구니"
- **구성 요소**:
  - **장바구니 아이템 목록**
    - 각 아이템은 다음 정보를 표시:
      - 메뉴명과 선택한 옵션 (예: "아메리카노(ICE) (샷 추가)")
      - 수량 (예: "X 1", "X 2")
      - 개별 가격 (예: "4,500원", "8,000원")
    - 옵션이 선택된 경우 옵션명을 괄호 안에 표시
    - 수량이 1보다 큰 경우 수량 표시
  - **총 금액**
    - 우측에 "총 금액" 레이블과 함께 총액 표시
    - 총액은 굵은 글씨로 강조
    - 예: "총 금액 12,500원"
  - **주문하기 버튼**
    - 총 금액 하단에 "주문하기" 버튼 배치
    - 배경색: 회색
    - 클릭 시 주문 처리

### 4.5 가격 계산 규칙
- 기본 메뉴 가격에 선택한 옵션의 추가 가격을 합산
- 예: 아메리카노(ICE) 4,000원 + 샷 추가 500원 = 4,500원
- 같은 메뉴라도 옵션이 다르면 별도 아이템으로 처리
- 장바구니에 같은 메뉴와 옵션 조합이 있으면 수량 증가

### 4.6 디자인 가이드
- **색상**:
  - 배경: 흰색
  - 텍스트: 다크 그레이
  - 강조 색상: 다크 그린 (COZY 로고)
  - 버튼: 회색
- **레이아웃**: 깔끔하고 미니멀한 디자인
- **타이포그래피**: 가독성 좋은 기본 폰트 사용

## 5. 관리자 화면 UI/UX 요구사항

### 5.1 화면 구성
관리자 화면은 헤더, 관리자 대시보드 영역, 재고 현황 영역, 주문 현황 영역으로 구성된다.

### 5.2 헤더 영역
- **위치**: 화면 최상단
- **구성 요소**:
  - 좌측: "COZY" 로고 박스
    - 배경색: 다크 그린
    - 텍스트 색상: 흰색
    - 형태: 직사각형 박스
  - 우측: 네비게이션 버튼
    - "주문하기" 버튼
    - "관리자" 버튼 (현재 활성화된 화면 표시, 더 진한 테두리 또는 배경색으로 구분)

### 5.3 관리자 대시보드 영역
- **위치**: 헤더 하단
- **제목**: "관리자 대시보드"
- **구성 요소**:
  - 주문 통계 요약 정보를 한 줄로 표시
  - 통계 항목:
    - "총 주문" (Total Orders): 전체 주문 수
    - "주문 접수" (Orders Received): 접수된 주문 수
    - "제조 중" (In Production): 현재 제조 중인 주문 수
    - "제조 완료" (Production Complete): 제조 완료된 주문 수
  - 각 통계는 슬래시(/)로 구분하여 표시
  - 예: "총 주문 1 / 주문 접수 1 / 제조 중 0 / 제조 완료 0"

### 5.4 재고 현황 영역
- **위치**: 관리자 대시보드 하단
- **제목**: "재고 현황"
- **레이아웃**: 각 메뉴 아이템별로 카드 형태로 표시 (가로 배치)
- **재고 카드 구성**:
  - **메뉴명**: 각 메뉴 아이템의 이름 표시
    - 예: "아메리카노 (ICE)", "아메리카노 (HOT)", "카페라떼"
  - **재고 수량**: 현재 재고 수량 표시
    - 형식: "10개" (숫자 + "개")
  - **재고 조정 버튼**:
    - "+" 버튼: 재고 증가 (클릭 시 1개씩 증가)
    - "-" 버튼: 재고 감소 (클릭 시 1개씩 감소)
    - 버튼은 재고 수량 하단에 배치
    - 작은 크기의 버튼으로 표시

### 5.5 주문 현황 영역
- **위치**: 재고 현황 하단
- **제목**: "주문 현황"
- **구성 요소**:
  - **주문 목록**: 각 주문을 카드 또는 리스트 아이템으로 표시
  - **주문 정보 표시 항목**:
    - **주문 일시**: 주문이 생성된 날짜와 시간
      - 형식: "7월 31일 13:00" (월 일 시:분)
    - **주문 아이템**: 주문된 메뉴와 수량
      - 형식: "아메리카노(ICE) x 1" (메뉴명(옵션) x 수량)
      - 옵션이 있는 경우 괄호 안에 표시
    - **주문 금액**: 해당 주문의 총 금액
      - 형식: "4,000원"
  - **주문 접수 버튼**:
    - 각 주문 항목의 우측에 "주문 접수" 버튼 배치
    - 클릭 시 해당 주문의 상태를 "주문 접수"로 변경
    - 주문이 접수되면 대시보드의 "주문 접수" 통계가 업데이트됨

### 5.6 주문 상태 관리
- **주문 상태 종류**:
  - 주문 접수: 고객이 주문을 완료한 상태
  - 제조 중: 관리자가 주문을 접수하고 제조를 시작한 상태
  - 제조 완료: 제조가 완료된 상태
- **상태 변경 흐름**:
  - 주문 접수 → 제조 중 → 제조 완료
  - 각 상태 변경은 관리자가 버튼을 통해 수동으로 처리

### 5.7 디자인 가이드
- **색상**:
  - 배경: 흰색
  - 텍스트: 다크 그레이
  - 강조 색상: 다크 그린 (COZY 로고)
  - 버튼: 회색
  - 활성화된 네비게이션 버튼: 더 진한 테두리 또는 배경색
- **레이아웃**: 깔끔하고 미니멀한 디자인, 섹션별로 명확히 구분
- **타이포그래피**: 가독성 좋은 기본 폰트 사용
- **카드/박스 디자인**: 각 섹션과 아이템은 직사각형 박스로 구분하여 표시

## 6. 백엔드 개발 요구사항

### 6.1 데이터 모델

#### 6.1.1 Menus (메뉴)
커피 메뉴 정보를 저장하는 테이블

- **필드**:
  - `id` (Primary Key): 메뉴 고유 식별자
  - `name` (VARCHAR): 커피 이름 (예: "아메리카노(ICE)", "카페라떼")
  - `description` (TEXT): 메뉴 설명
  - `price` (INTEGER): 기본 가격 (원 단위)
  - `image` (VARCHAR): 이미지 파일 경로 또는 URL
  - `stock` (INTEGER): 재고 수량
  - `created_at` (TIMESTAMP): 생성 일시
  - `updated_at` (TIMESTAMP): 수정 일시

#### 6.1.2 Options (옵션)
메뉴에 추가할 수 있는 옵션 정보를 저장하는 테이블

- **필드**:
  - `id` (Primary Key): 옵션 고유 식별자
  - `name` (VARCHAR): 옵션 이름 (예: "샷 추가", "시럽 추가")
  - `price` (INTEGER): 옵션 추가 가격 (원 단위)
  - `menu_id` (Foreign Key): 연결된 메뉴 ID (Menus 테이블 참조)
  - `created_at` (TIMESTAMP): 생성 일시
  - `updated_at` (TIMESTAMP): 수정 일시

#### 6.1.3 Orders (주문)
주문 정보를 저장하는 테이블

- **필드**:
  - `id` (Primary Key): 주문 고유 식별자
  - `order_date` (TIMESTAMP): 주문 일시
  - `status` (VARCHAR): 주문 상태
    - 값: 'received' (주문 접수), 'in_production' (제조 중), 'completed' (제조 완료)
  - `total_amount` (INTEGER): 주문 총 금액 (원 단위)
  - `created_at` (TIMESTAMP): 생성 일시
  - `updated_at` (TIMESTAMP): 수정 일시

#### 6.1.4 OrderItems (주문 상세)
주문에 포함된 각 메뉴 아이템 정보를 저장하는 테이블

- **필드**:
  - `id` (Primary Key): 주문 상세 고유 식별자
  - `order_id` (Foreign Key): 주문 ID (Orders 테이블 참조)
  - `menu_id` (Foreign Key): 메뉴 ID (Menus 테이블 참조)
  - `quantity` (INTEGER): 주문 수량
  - `item_price` (INTEGER): 해당 아이템의 단가 (메뉴 가격 + 옵션 가격 합계)
  - `created_at` (TIMESTAMP): 생성 일시

#### 6.1.5 OrderItemOptions (주문 아이템 옵션)
주문 아이템에 선택된 옵션 정보를 저장하는 테이블

- **필드**:
  - `id` (Primary Key): 주문 아이템 옵션 고유 식별자
  - `order_item_id` (Foreign Key): 주문 상세 ID (OrderItems 테이블 참조)
  - `option_id` (Foreign Key): 옵션 ID (Options 테이블 참조)
  - `created_at` (TIMESTAMP): 생성 일시

### 6.2 데이터 스키마를 위한 사용자 흐름

#### 6.2.1 메뉴 조회 및 표시
1. 사용자가 '주문하기' 화면에 접속
2. 프런트엔드가 백엔드 API를 호출하여 Menus 테이블에서 메뉴 목록 조회
3. 조회된 메뉴 정보(이름, 설명, 가격, 이미지)를 브라우저 화면에 표시
4. 관리자 화면에서는 Menus 테이블의 재고 수량(stock) 정보도 함께 표시

#### 6.2.2 장바구니 관리
1. 사용자가 메뉴를 선택하고 옵션을 선택
2. 선택 정보는 프런트엔드의 장바구니 상태에 임시 저장
3. 장바구니에 선택한 메뉴, 수량, 옵션, 금액이 표시됨
4. 장바구니 정보는 주문 전까지 프런트엔드에서만 관리

#### 6.2.3 주문 생성
1. 사용자가 장바구니에서 '주문하기' 버튼 클릭
2. 프런트엔드가 주문 정보를 백엔드 API로 전송
3. 백엔드가 Orders 테이블에 주문 정보 저장:
   - 주문 일시(order_date) 기록
   - 주문 상태(status)를 'received'로 설정
   - 주문 총 금액(total_amount) 계산하여 저장
4. 백엔드가 OrderItems 테이블에 주문 상세 정보 저장:
   - 각 메뉴별로 주문 수량, 단가 저장
5. 백엔드가 OrderItemOptions 테이블에 선택된 옵션 정보 저장
6. 주문된 메뉴의 재고 수량 차감:
   - Menus 테이블의 stock 필드를 주문 수량만큼 감소

#### 6.2.4 주문 현황 조회 및 상태 변경
1. 관리자가 관리자 화면의 '주문 현황' 영역 접근
2. 프런트엔드가 백엔드 API를 호출하여 Orders 테이블에서 주문 목록 조회
3. 주문 목록에 다음 정보 표시:
   - 주문 일시 (order_date)
   - 주문 내용 (메뉴명, 수량, 옵션, 금액)
   - 주문 상태 (status)
4. 주문의 기본 상태는 'received' (주문 접수)
5. 관리자가 '제조 시작' 버튼 클릭:
   - 해당 주문의 상태를 'in_production' (제조 중)으로 변경
6. 관리자가 '제조 완료' 버튼 클릭:
   - 해당 주문의 상태를 'completed' (제조 완료)로 변경
7. 상태 변경 시 Orders 테이블의 status 필드와 updated_at 필드 업데이트

### 6.3 API 설계

#### 6.3.1 메뉴 목록 조회
- **엔드포인트**: `GET /api/menus`
- **설명**: 데이터베이스에서 커피 메뉴 목록을 조회하여 반환
- **요청**: 없음
- **응답**:
  ```json
  [
    {
      "id": 1,
      "name": "아메리카노(ICE)",
      "description": "에스프레소에 물을 넣어 만든 시원한 커피",
      "price": 4000,
      "image": "/images/americano-ice.jpg",
      "stock": 10,
      "options": [
        {
          "id": 1,
          "name": "샷 추가",
          "price": 500
        },
        {
          "id": 2,
          "name": "시럽 추가",
          "price": 0
        }
      ]
    }
  ]
  ```
- **비고**: 
  - 각 메뉴에 연결된 Options 정보도 함께 반환
  - 재고 수량(stock) 정보 포함

#### 6.3.2 주문 생성
- **엔드포인트**: `POST /api/orders`
- **설명**: 주문 정보를 데이터베이스에 저장하고, 주문된 메뉴의 재고 수량을 차감
- **요청 본문**:
  ```json
  {
    "items": [
      {
        "menuId": 1,
        "quantity": 2,
        "optionIds": [1],
        "itemPrice": 4500
      },
      {
        "menuId": 2,
        "quantity": 1,
        "optionIds": [],
        "itemPrice": 4000
      }
    ],
    "totalAmount": 13000
  }
  ```
- **응답**:
  ```json
  {
    "id": 123,
    "orderDate": "2024-12-14T10:30:00Z",
    "status": "received",
    "totalAmount": 13000,
    "items": [
      {
        "id": 1,
        "menuId": 1,
        "menuName": "아메리카노(ICE)",
        "quantity": 2,
        "itemPrice": 4500,
        "options": [
          {
            "id": 1,
            "name": "샷 추가"
          }
        ]
      }
    ]
  }
  ```
- **비고**:
  - 주문 생성 시 Orders, OrderItems, OrderItemOptions 테이블에 데이터 저장
  - 주문된 각 메뉴의 재고 수량을 Menus 테이블에서 차감
  - 재고 부족 시 에러 응답 반환

#### 6.3.3 주문 목록 조회
- **엔드포인트**: `GET /api/orders`
- **설명**: 주문 목록을 조회하여 반환 (관리자 화면용)
- **요청**: 없음 (또는 쿼리 파라미터로 필터링 가능)
- **응답**:
  ```json
  [
    {
      "id": 123,
      "orderDate": "2024-12-14T10:30:00Z",
      "status": "received",
      "totalAmount": 13000,
      "items": [
        {
          "menuName": "아메리카노(ICE)",
          "quantity": 2,
          "itemPrice": 4500,
          "options": ["샷 추가"]
        }
      ]
    }
  ]
  ```
- **비고**: 
  - 주문 목록은 최신순으로 정렬하여 반환
  - 각 주문의 상세 정보(메뉴, 수량, 옵션) 포함

#### 6.3.4 주문 상세 조회
- **엔드포인트**: `GET /api/orders/:orderId`
- **설명**: 주문 ID를 전달하면 해당 주문의 상세 정보를 반환
- **요청 파라미터**: 
  - `orderId` (URL 파라미터): 주문 ID
- **응답**:
  ```json
  {
    "id": 123,
    "orderDate": "2024-12-14T10:30:00Z",
    "status": "received",
    "totalAmount": 13000,
    "items": [
      {
        "menuId": 1,
        "menuName": "아메리카노(ICE)",
        "quantity": 2,
        "itemPrice": 4500,
        "options": [
          {
            "id": 1,
            "name": "샷 추가",
            "price": 500
          }
        ]
      }
    ]
  }
  ```

#### 6.3.5 주문 상태 변경
- **엔드포인트**: `PATCH /api/orders/:orderId/status`
- **설명**: 주문의 상태를 변경 (주문 접수 → 제조 중 → 제조 완료)
- **요청 파라미터**: 
  - `orderId` (URL 파라미터): 주문 ID
- **요청 본문**:
  ```json
  {
    "status": "in_production"
  }
  ```
- **응답**:
  ```json
  {
    "id": 123,
    "status": "in_production",
    "updatedAt": "2024-12-14T10:35:00Z"
  }
  ```
- **비고**: 
  - 상태 변경 시 Orders 테이블의 status와 updated_at 필드 업데이트
  - 유효한 상태 전환만 허용 (received → in_production → completed)

#### 6.3.6 재고 수량 조정
- **엔드포인트**: `PATCH /api/menus/:menuId/stock`
- **설명**: 관리자가 메뉴의 재고 수량을 수동으로 조정
- **요청 파라미터**: 
  - `menuId` (URL 파라미터): 메뉴 ID
- **요청 본문**:
  ```json
  {
    "change": 1
  }
  ```
- **응답**:
  ```json
  {
    "id": 1,
    "name": "아메리카노(ICE)",
    "stock": 11
  }
  ```
- **비고**: 
  - change 값이 양수면 증가, 음수면 감소
  - 재고 수량은 0 미만으로 내려가지 않도록 검증

#### 6.3.7 주문 통계 조회
- **엔드포인트**: `GET /api/orders/stats`
- **설명**: 주문 통계 정보를 조회 (관리자 대시보드용)
- **요청**: 없음
- **응답**:
  ```json
  {
    "total": 10,
    "received": 3,
    "inProduction": 2,
    "completed": 5
  }
  ```
- **비고**: 
  - 각 상태별 주문 수를 집계하여 반환

### 6.4 에러 처리
- **400 Bad Request**: 잘못된 요청 데이터
- **404 Not Found**: 존재하지 않는 리소스 (메뉴, 주문 등)
- **409 Conflict**: 재고 부족 등 비즈니스 로직 위반
- **500 Internal Server Error**: 서버 내부 오류

### 6.5 데이터 검증
- 주문 생성 시:
  - 메뉴 ID 유효성 검증
  - 옵션 ID 유효성 검증
  - 수량이 1 이상인지 검증
  - 재고 수량 확인
- 재고 조정 시:
  - 재고 수량이 0 미만으로 내려가지 않도록 검증
- 주문 상태 변경 시:
  - 유효한 상태 전환인지 검증